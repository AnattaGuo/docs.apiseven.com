---
title: etcd 资源
slug: /cluster/etcd
tags:
  - API7 Enterprise
---

## 名词解释

### etcd资源
etcd 是 API7 网关存储配置数据的组件，一条 etcd 资源指的就是一个 etcd 集群。如果考虑高可用，建议一个 etcd 集群至少包含三个节点。

不同网关集群的配置数据可以存放在不同etcd集群中，通过资源隔离提升安全性，也可以放在同一个etcd集群中方便统一管理和节约资源。

### etcd 资源名称
帮助用户识别不同 etcd 集群。

### etcd 描述
对 etcd 集群的进一步说明，通常包括用途定位、使用注意事项等。

### 节点地址
etcd 集群需要至少一个节点，如需考虑etcd高可用，则需要至少三个节点。同一个 etcd 集群下所有节点中储存的配置数据是一致且实时同步的。节点地址包括节点的ip地址和端口。

### 前缀

### 状态
运行中：该 etcd 集群可以正常连接。

已停止：该 etcd 集群无法连接（没有足够的健康节点）。

### 身份认证
API7 网关需要对 etcd 的完全访问权限才可正常运行。更多背景知识请参考[etcd 身份认证文档](https://etcd.io/docs/v2.3/authentication/).

如果在 etcd 集群中开启了身份认证，则需要在API7网关侧录入可供使用的root用户名称及密码。如果用户名密码无效，会导致。

### 双向认证
考虑 etcd 安全性，可以为每个 etcd 用户添加证书开启双向认证。更多背景知识请参考[etcd 安全模式文档](https://etcd.io/docs/v3.2/op-guide/security/).

如果在 etcd 集群中启用了证书，则需要在API7网关侧录入证书、秘钥、证书颁发机构信息。如果证书过期或失效，会导致。

## 新建 etcd 资源
#### 使用场景
以下场景推荐使用多个 etc d资源：
1. 不同业务的网关配置数据需要严格隔离，不可混用 etcd。
2. 网关测试集群和网关生产集群的数据需要严格隔离。

#### 使用限制
需要先搭建好 etcd 集群后再来 API7 网关侧录入信息。

#### 操作步骤
**步骤1**：登录 API7 Enterprise 控制台。

**步骤2**：在顶部导航菜单，点击「集群管理」。

**步骤3**：在左侧菜单，点击「etcd 资源」。

**步骤4**：点击「新建」按钮。

**步骤5**：根据名词解释，填写表单；

**步骤6**：点击「添加」按钮。

**验证方式**：
1. etcd 资源创建成功后，可以在 etcd 资源列表中看到新的 etcd 集群信息。
2. 新建网关集群时，可以选择到新创建的 etcd 资源。

## 配置 etc d资源
### 使用场景
编辑 etcd 资源的名称、描述、节点地址、身份认证、双向认证信息。

#### 使用限制
如果未及时更新身份认证中的用户名/密码，或证书到期未更新，将有如下影响：
1. 数据面不重启则可用缓存的配置信息继续运行，不影响线上业务。
2. 控制面无法修改网关配置信息，控制台上无法查看和修改网关集群配置信息。
3. 数据面一旦重启，将丢失所有配置数据，网关启动失败，影响线上业务。

#### 操作步骤
**步骤1**：登录 API7 Enterprise 控制台。

**步骤2**：在顶部导航菜单，点击「集群管理」。

**步骤3**：在左侧菜单，点击「etcd 资源」。

**步骤4**：点击对应 etcd 的「配置」按钮。

**步骤5**：编辑集群的名称/备注等信息。

**步骤6**：点击「更新」按钮。

**验证方式**：在 etcd 资源列表中，可以看到 etcd 资源的名称/描述等信息已更新。

## 删除etcd资源
#### 使用场景
业务下线，etcd 资源已不再配合 API7 网关使用。

#### 使用限制
1. etcd 资源删除并不会销毁 etcd 集群本身，也不会断开数据面与 etcd 的连接，只是删除了控制面和 etcd 的连接，导致无法在控制台查看并修改网关集群配置信息，不会中断线上业务。
2. etcd 资源删除后不可恢复。

#### 操作步骤

**步骤1**：点击对应 etcd 资源的「删除」按钮。

**步骤2**：点击「确定」按钮。

**验证方式**：在 etcd 资源列表中，已看不到被删除的 etcd 资源。
