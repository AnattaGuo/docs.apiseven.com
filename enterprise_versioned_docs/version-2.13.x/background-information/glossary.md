---
title: 名词解释
slug: /background-information/glossary
tags:
  - API7 Enterprise
---

## 集群


#### 集群 ID

集群的唯一标识，不可修改。

#### 集群状态

正常：集群可正常连接对应的 etcd 资源。

异常：集群无法连接对应的 etcd 资源，导致网关数据面无法运行。

## 工作分区
#### 主机名

对工作分区内所有路由/API的格式要求。不符合主机名格式的路由/API 无法添加。

## etcd资源
#### 节点地址

etcd 集群需要至少一个节点，如需考虑etcd高可用，则需要至少三个节点。同一个 etcd 集群下所有节点中储存的配置数据是一致且实时同步的。节点地址包括节点的ip地址和端口。

#### 状态
运行中：该 etcd 集群可以正常连接。

已停止：该 etcd 集群无法连接（没有足够的健康节点）。

#### 身份认证

API7 网关需要对 etcd 的完全访问权限才可正常运行。更多背景知识请参考[etcd 身份认证文档](https://etcd.io/docs/v2.3/authentication/).

如果在 etcd 集群中开启了身份认证，则需要在API7网关侧录入可供使用的root用户名称及密码。如果用户名密码无效，会导致。

#### 双向认证

考虑 etcd 安全性，可以为每个 etcd 用户添加证书开启双向认证。更多背景知识请参考[etcd 安全模式文档](https://etcd.io/docs/v3.2/op-guide/security/).

如果在 etcd 集群中启用了证书，则需要在API7网关侧录入证书、秘钥、证书颁发机构信息。如果证书过期或失效，会导致。

## 上游
#### 上游类型

上游使用的负载均衡算法的类型。

#### 负载均衡算法

目前支持以下算法：
- roundrobin - 带权轮询。
- chash - 带权一致性哈希。
- ewma - 指数加权移动平均法，选择延迟最小的节点。[参考EWMA chart](https://en.wikipedia.org/wiki/EWMA_chart)。
- least_conn - 最小连接数。选择 (active_conn + 1) / weight 最小的节点。此处的 active connection 概念跟 NGINX 的相同，它是当前正在被请求使用的连接。

#### 目标节点

上游的服务节点，网关转发流量的实际去处。必须是固定不变的静态节点，可以是ip地址或者域名。
如果所有目标节点都为空，则上游会返回`502`状态码。

#### 权重

用于负载均衡算法的节点权重，影响节点的选择。

#### Host请求头

可以选择与客户端保持一致的主机名，或使用目标节点列表中的主机名或IP.

#### 重试次数

使用 NGINX 重试机制将请求传递给下一个上游，默认启用重试机制且次数为后端可用的节点数量。如果指定了具体重试次数，它将覆盖默认值。当设置为 0 时，表示不启用重试机制。如果不填写任何值，则将使用目标节点的数量。

#### 协议

跟上游通信时使用的 scheme。对于 7 层代理，可选值为 [http, https, grpc, grpcs]。默认值为 http。

#### 连接超时

建立从请求到上游服务器的连接的超时时间。

#### 发送超时

发送数据到上游服务器的超时时间。

#### 接收超时

从上游服务器接收数据的超时时间。

#### 健康检查-主动检查

主动健康检查主要是指通过预设的探针类型，主动探测上游节点的存活性，无论上游是否收到了请求。目前支持 HTTP、HTTPS、TCP 三种探针类型。

当发向健康节点 A 的 N 个连续探针都失败时（取决于如何配置），则该节点将被标记为不健康，不健康的节点将会被负载均衡器忽略，无法收到请求；若某个不健康的节点，连续 M 个探针都成功，则该节点将被重新标记为健康，进而可以被代理。

#### 健康检查-主动检查-类型

执行主动健康检查的探针类型，目前支持 HTTP、HTTPS、TCP 三种。

#### 健康检查-主动检查-超时时间

主动健康检查的套接字的超时时间。

#### 健康检查-主动检查-并行数量

在主动健康检查中同时检查的目标节点数量。

#### 健康检查-主动检查-主机名

进行主动健康检查时使用的 HTTP 请求主机名。若使用 TCP 无需填写。

#### 健康检查-主动检查-端口

主动检查的 HTTP 请求主机端口。

#### 健康检查-主动检查-请求路径

向目标节点发出 HTTP 请求时应使用的路径。

#### 健康检查-主动检查-请求头

主动检查使用 HTTP 或 HTTPS 类型检查时，设置额外的请求头信息。

#### 健康检查-主动检查-健康状态-间隔时间

对健康的上游服务目标节点进行主动健康检查的间隔时间（以秒为单位）。数值为0表示对健康节点不进行主动健康检查。

#### 健康检查-主动检查-健康状态-成功次数

主动健康检查的 HTTP 成功次数，若达到此值，表示上游服务目标节点是健康的。

#### 健康检查-主动检查-健康状态-状态码

HTTP 状态码列表，当探针在主动健康检查中返回时，视为健康。

#### 健康检查-主动检查-不健康状态-超时时间

活动探针中认为目标不健康的超时次数。

#### 健康检查-主动检查-不健康状态-间隔时间

对不健康目标的主动健康检查之间的间隔（以秒为单位）。

#### 健康检查-主动检查-不健康状态-状态码

HTTP 状态码列表，当探针在主动健康检查中返回时，视为不健康。

#### 主健康检查-主动检查-不健康状态-HTTP失败次数

主动健康检查的 HTTP 失败次数，默认值为0。若达到此值，表示上游服务目标节点是不健康的。

#### 健康检查-主动检查-不健康状态-TCP失败次数

主动探测中 TCP 失败次数超过该值时，认为目标不健康。

#### 健康检查-被动检查

被动健康检查是指，通过判断从 API7 网关转发到上游节点的请求响应状态，来判断对应的上游节点是否健康，如果上游一直没有请求，则不会执行被动健康检查。
相对于主动健康检查，被动健康检查的方式无需发起额外的探针，但是也无法提前感知节点状态，可能会有一定量的失败请求。

若发向健康节点 A 的 N 个连续请求都被判定为失败（取决于如何配置），则该节点将被标记为不健康。

由于不健康的节点无法收到请求，仅使用被动健康检查策略无法重新将节点标记为健康，因此必须同时开启主动健康检查策略。

#### 健康检查-被动检查-类型

执行被动健康检查的探针类型，目前支持 HTTP、HTTPS、TCP 三种，应当与上游的协议类型保持一致。

#### 健康检查-被动检查-健康状态-状态码

HTTP 状态码列表，当探针在被动健康检查中返回时，视为健康。

#### 健康检查-被动检查-健康状态-成功次数

被动健康检查的 HTTP 成功次数，若达到此值，表示上游服务目标节点是健康的。

#### 健康检查-被动检查-不健康状态-超时次数

活动探针中认为目标不健康的超时次数。

#### 健康检查-被动检查-不健康状态-TCP失败次数

被动探测中 TCP 失败次数超过该值时，认为目标不健康。

#### 健康检查-被动检查-不健康状态-HTTP失败次数

被动健康检查的 HTTP 失败次数，默认值为0。若达到此值，表示上游服务目标节点是不健康的。

#### 健康检查-被动检查-不健康状态-状态码

HTTP 状态码列表，当探针在被动健康检查中返回时，视为不健康。


## 开发者门户
#### API

对应API7网关上的路由/API。

#### 目录

目录一般用于 API 分类，如将属于同一模块或功能相关的 API 放在同一目录下，开发者可以基于目录快速查找 API。每个 API 只能属于一个目录。

:::info

当前仅支持 `default` 目录，后续将支持新增和管理自定义目录。

:::

#### 关联集群/关联路由

发布到开发者门户的 API 必须和 API7 网关中已有的路由相关关联。路由所在的集群即为此 API 所关联的集群。

开发者门户中的 API 与其关联路由是实时联动的，如果在 API7 网关中修改了该路由，或者更换该 API 所关联的路由，则会立刻影响对应 API 的行为和用法。因此当 API 关联的路由发生调整时，请及时修改对应 API 文档并通知订阅的开发者。

#### 认证方式

API 的关联路由上如果开启了认证类插件，则需要开发者需要按照对应的方式认证才可调用此 API。

:::info

当前仅支持 `key-auth` 认证方式，后续将支持更多。

:::

#### API订阅

开发者以应用为主体申请订阅 API。即 API 的调用许可和凭证，不属于某个特定的开发者，而是应该根据业务划分，属于某个应用。

订阅成功后应用方可调用此 API。如果 API 开启了认证，则应用会获得对应的访问凭证。
对于同一个 API，不同应用的访问凭证是不同的，但对于同一个应用，如果订阅了多个使用同样认证方式的 API，则对应的访问凭证是一样的。如果取消某个应用对当前 API 的订阅，则此应用的访问凭证会失效。

每个应用会映射 API7 网关中的一个消费者（Consumer）；每条 API 订阅成功，会映射为在该 API 的关联路由中，将对应的消费者（Consumer）添加入访问白名单中；取消 API 订阅，会映射为在该 API 的关联路由中，从访问白名单里删除对应的消费者（Consumer）。因此，如果在 API7 网关侧直接更改了 API 关联路由中的访问白名单，会破坏 API 订阅关系，引起错误。

:::info

- 若API没有开启任何认证，实际上任何应用都可以直接访问，不需要订阅。
- 暂不支持已经订阅成功的应用更换访问凭证。

:::

#### 应用

订阅 API 并发起调用的主体，由开发者创建，通常对应业务中的一个产品或一组服务。

每个应用将拥有一组 API key，作为调用 API 的凭证。

应用属于组织而非属于某个具体的开发者。组织内获得授权的开发者，都可以查看应用的信息并使用 API key，他们在 API 生产者的视角里是同一个调用来源。

#### 开发者

API 的实际使用者，以组织为单位进行管理。与之对应的概念是 API 生产者，也就是操作 API7 网关并发布API的用户。

开发者账户只能登录并使用开发者门户，不能登录并使用 API7 网关。

#### 组织

管理开发者及应用的单位，组织之间的数据是隔离的，可用于多租户管理。
每个开发者必须加入一个组织，且无法同时加入多个组织。

:::info

- 开发者的组织信息与 API7 网关无关，不会对网关产生任何影响。
- 目前只提供默认的 default 组织，后续支持开发者自定义创建并管理组织。

:::

#### 开发者邮箱

开发者账户的唯一标识，邮箱不可重复使用。

:::info

开发者账户创建时的默认密码即为邮箱，后续支持修改及重置密码。

:::

#### 开发者门户地址

开发者门户地址指的是访问开发者门户展示端（供开发者使用的站点）的 URL，比如 `https://mydevportal.com`。此站点需要自行部署，且必须是唯一的。


